---
published: true
date: '2022-08-31 23:53 +0200'
title: 'Cisco 8000 software manageability: Golden ISO (GISO)'
author: Frederic Cuiller
position: hidden
excerpt: >-
  This tutorial will describe and illustrate how to generate a Golden ISO (GISO)
  image for Cisco 8000 routers. GISO can be used to stage, re-image, patch or
  upgrade Cisco 8000 routers. 
tags:
  - iosxr
  - Cisco 8000
  - GISO
  - XR7
  - Golden ISO
---
{% include toc icon="table" title="Cisco 8000 software manageability: Golden ISO (GISO)" %}

## Introduction

This tutorial will describe and illustrate how to generate a Golden ISO (GISO) image for Cisco 8000 routers. GISO can be used to stage, re-image, patch or upgrade Cisco 8000 routers. 

**Info:** gisobuild.py can only be used to generate 7.5.1+ images. If a pre 7.5.1 image is needed, please get in touch with TAC to generate it for you.
{: .notice--primary}

## Software Lifecycle in a Router

![software-lifecycle.png]({{site.baseurl}}/images/software-lifecycle.png)

It’s common to see different phases for production devices:

- Software staging: initial router staging and deployment, first installation with qualified software.
- Software patching: router runs same version of code, SMUs are installed to fix software defects, improve stability and reliability or patch security vulnerabilities.
- Software upgrade: major software upgrade to new qualified version of code. Driven by new requirements (hardware, features) or software obsolescence (End Of Life).

Patching and upgrade frequency depends on operators’ software strategy.  

For staging, turboboot was traditionally used for IOS-XR 32-bit (using TFTP or USB). Once staged, packages and SMUs had to be installed (triggering a second reload) and then target configuration committed.  

For software patching, the usual 3-step install add, activate and commit was used to add SMUs and packages (such MPLS, Multicast, FPD).  

For software upgrades, same 3-step process was executed. Target release packages and SMUs could be added and activated in one-shot.  

The challenge is multiple processes, involving different files had to be employed. Moreover, in some cases two router reboots were required to reach software target, adding more time to operations.

## Golden ISO concept & use cases

Golden ISO concept was introduced with IOS-XR 64bit and extended to IOS-XR7 architecture which is used by Cisco 8000.  

Golden ISO (GISO) is a self-custom-built ISO addressing customers’ needs. It contains:
- Mandatory base image (ISO format)
- Optional files/packages
-- optional packages
--- Some optional packages are contained within the base image, e.g: BGP
--- Additional optional packages are available on CCO, e.g: cdp, telnet, healthcheck
-- SMUs
-- ZTP config
-- XR config

Golden ISO is built with gisobuild, a Cisco provided tool available on github.
Files generated by gisobuild can be used for the 3 operations mentioned earlier and covers following use cases:

- Router staging, or re-imaging (USB boot, PXE boot techniques)
- Software upgrade (install replace technique)
- Software patching (install replace technique)

Rest of this post will focus on how-to deploy gisobuild and how to use it to create a GISO.

## Server Preparation

For this article and at the time of writing, a Debian 11.3 server is used. It’s important to respect supported Linux distributions as stated in gisobuild [GitHub documentation](https://github.com/ios-xr/gisobuild).

<div class="highlighter-rouge">
<pre class="highlight">
<code>
cisco@debian-template:/mnt/giso$ lsb_release -a
No LSB modules are available.
Distributor ID:	Debian
<mark>Description:	Debian GNU/Linux 11 (bullseye)</mark>
Release:	11
Codename:	bullseye
</code>
</pre>
</div>

The first step is to clone the repository:

<div class="highlighter-rouge">
<pre class="highlight">
<code>
cisco@debian-template:~$ git clone https://github.com/ios-xr/gisobuild.git
Cloning into 'gisobuild'...
remote: Enumerating objects: 289, done.
remote: Counting objects: 100% (181/181), done.
remote: Compressing objects: 100% (117/117), done.
remote: Total 289 (delta 94), reused 144 (delta 63), pack-reused 108
Receiving objects: 100% (289/289), 6.06 MiB | 12.93 MiB/s, done.
Resolving deltas: 100% (155/155), done.
</code>
</pre>
</div>

Linux and Python dependencies are required to use the various tools. If the server has access to podman and the docker repositories, then the gisobuild tool can be run within a container using the --docker option. However, if the other tooling (isols & isodiff) is required, or the server does not have access to docker, then the additional dependencies now need to be set up. The *prep_dependency.sh* script located in the *setup* directory contains everything gisobuild.py needs:

<div class="highlighter-rouge">
<pre class="highlight">
<code>
cisco@debian-template:~/gisobuild/setup$ <mark>sudo ./prep_dependency.sh</mark>
Get:1 http://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]
Hit:2 http://ftp.nl.debian.org/debian bullseye InRelease
Get:3 http://ftp.nl.debian.org/debian bullseye-updates InRelease [44.1 kB]
Get:4 http://ftp.nl.debian.org/debian bullseye-updates/main Sources.diff/Index [9483 B]
Get:5 http://ftp.nl.debian.org/debian bullseye-updates/main amd64 Packages.diff/Index [9483 B]
Get:6 http://ftp.nl.debian.org/debian bullseye-updates/main Sources T-2022-08-18-2019.35-F-2022-08-18-2019.35.pdiff [390 B]
Get:6 http://ftp.nl.debian.org/debian bullseye-updates/main Sources T-2022-08-18-2019.35-F-2022-08-18-2019.35.pdiff [390 B]
Get:7 http://ftp.nl.debian.org/debian bullseye-updates/main amd64 Packages T-2022-08-18-2019.35-F-2022-08-18-2019.35.pdiff [284 B]
Get:7 http://ftp.nl.debian.org/debian bullseye-updates/main amd64 Packages T-2022-08-18-2019.35-F-2022-08-18-2019.35.pdiff [284 B]
Get:8 http://security.debian.org/debian-security bullseye-security/main Sources [150 kB]
Get:9 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [180 kB]
Get:10 http://security.debian.org/debian-security bullseye-security/main Translation-en [113 kB]
Fetched 555 kB in 4s (139 kB/s)
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
cpio is already the newest version (2.13+dfsg-4).
openssl is already the newest version (1.1.1n-0+deb11u3).
openssl set to manually installed.
python3 is already the newest version (3.9.2-3).
python3 set to manually installed.
python3-distutils is already the newest version (3.9.2-1).
python3-distutils set to manually installed.
python3-yaml is already the newest version (5.3.1-5).
python3-yaml set to manually installed.
The following additional packages will be installed:
  debugedit libarchive13 libcreaterepo-c0 libcurl4 libdrpm0 libdw1 libgomp1 liblua5.2-0 liblzo2-2 libmagic-mgc libmagic1 libmodulemd2 librpm9 librpmbuild9 librpmio9 librpmsign9 libzck1
  python3-pyparsing rpm-common rpm2cpio
Suggested packages:
  rpm-i18n wodim cdrkit-doc lrzip python-pyparsing-doc alien elfutils rpmlint rpm2html
The following NEW packages will be installed:
  createrepo-c debugedit file genisoimage libarchive13 libcreaterepo-c0 libcurl4 libdrpm0 libdw1 libgomp1 liblua5.2-0 liblzo2-2 libmagic-mgc libmagic1 libmodulemd2 librpm9 librpmbuild9
  librpmio9 librpmsign9 libzck1 python3-defusedxml python3-packaging python3-pyparsing python3-rpm rpm rpm-common rpm2cpio squashfs-tools
0 upgraded, 28 newly installed, 0 to remove and 9 not upgraded.
Need to get 16.3 MB of archives.
After this operation, 29.7 MB of additional disk space will be used.
Get:1 http://security.debian.org/debian-security bullseye-security/main amd64 libcurl4 amd64 7.74.0-1.3+deb11u2 [345 kB]
Get:2 http://ftp.nl.debian.org/debian bullseye/main amd64 libmagic-mgc amd64 1:5.39-3 [273 kB]
-- Snip --
Fetched 16.3 MB in 4s (4448 kB/s)
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
	LANGUAGE = (unset),
	LC_ALL = (unset),
	LC_CTYPE = "UTF-8",
	LC_TERMINAL = "iTerm2",
	LANG = "en_US"
    are supported and installed on your system.
perl: warning: Falling back to a fallback locale ("en_US").
locale: Cannot set LC_CTYPE to default locale: No such file or directory
locale: Cannot set LC_ALL to default locale: No such file or directory
Selecting previously unselected package libmagic-mgc.
(Reading database ... 31728 files and directories currently installed.)
Preparing to unpack .../00-libmagic-mgc_1%3a5.39-3_amd64.deb ...
Unpacking libmagic-mgc (1:5.39-3) ...
-- Snip --
Selecting previously unselected package squashfs-tools.
Preparing to unpack .../27-squashfs-tools_1%3a4.4-2+deb11u2_amd64.deb ...
Unpacking squashfs-tools (1:4.4-2+deb11u2) ...
Setting up libdw1:amd64 (0.183-1) ...
-- Snip --
Setting up python3-rpm (4.16.1.2+dfsg1-3) ...
Processing triggers for libc-bin (2.31-13+deb11u3) ...
</code>
</pre>
</div>

After this step, gisobuild.py is available to use:

<div class="highlighter-rouge">
<pre class="highlight">
<code>
cisco@debian-template:~/gisobuild/src$ <mark>./gisobuild.py --help</mark>
usage: gisobuild.py [-h] [--iso ISO] [--repo REPO [REPO ...]] [--bridging-fixes BRIDGE_FIXES [BRIDGE_FIXES ...]] [--xrconfig XRCONFIG] [--ztp-ini ZTP_INI] [--label LABEL]
                    [--out-directory OUT_DIRECTORY] [--yamlfile CLI_YAML] [--clean] [--pkglist PKGLIST [PKGLIST ...]] [--script SCRIPT] [--docker] [--x86-only] [--migration]
                    [--remove-packages REMOVE_PACKAGES [REMOVE_PACKAGES ...]] [--skip-usb-image] [--copy-dir COPY_DIRECTORY] [--clear-bridging-fixes] [--verbose-dep-check] [--debug]
                    [--isoinfo ISOINFO] [--image-script IMAGE_SCRIPT] [--version]

Utility to build Golden ISO for IOS-XR.

optional arguments:
  -h, --help            show this help message and exit
  --iso ISO             Path to Mini.iso/Full.iso file
  --repo REPO [REPO ...]
                        Path to RPM repository. For LNT, user can specify .rpm, .tgz, .tar filenames, or directories. RPMs are only used if already included in the ISO, or specified by
                        the user via the --pkglist option.
  --bridging-fixes BRIDGE_FIXES [BRIDGE_FIXES ...]
                        Bridging rpms to package. For EXR, takes from-release or rpm names; for LNT, the user can specify the same file types as for the --repo option.
  --xrconfig XRCONFIG   Path to XR config file
  --ztp-ini ZTP_INI     Path to user ztp ini file
  --label LABEL, -l LABEL
                        Golden ISO Label
  --out-directory OUT_DIRECTORY
                        Output Directory
  --yamlfile CLI_YAML   Cli arguments via yaml
  --clean               Delete output dir before proceeding
  --pkglist PKGLIST [PKGLIST ...]
                        Packages to be added to the output GISO. For eXR: optional rpm or smu to package. For LNT: either full package filenames or package names for user installable
                        packages can be specified. Full package filenames can be specified to choose a particular version of a package, the rest of the block that the package is in will
                        be included as well. Package names can be specified to include optional packages in the output GISO.
  --docker, --use-container
                        Build GISO in container environment.Pulls and run pre-built container image to build GISO.
  --version             Print version of this script and exit

EXR only build options:
  --script SCRIPT       Path to user executable script executed as part of bootup post activate.
  --x86-only            Use only x86_64 rpms even if other architectures are applicable.
  --migration           To build Migration tar only for ASR9k

LNT only build options:
  --remove-packages REMOVE_PACKAGES [REMOVE_PACKAGES ...]
                        Remove RPMs, specified in a comma separated list. These are matched against user installable package names, and must be the whole package name, e.g: xr-bgp
  --skip-usb-image      Do not build the USB image
  --copy-dir COPY_DIRECTORY
                        Copy built artefacts to specified directory if provided. The specified directory must already exist, be writable by the builder and must not contain a previously
                        built artefact with the same name.
  --clear-bridging-fixes
                        Remove all bridging bugfixes from the input ISO
  --verbose-dep-check   Verbose output for the dependency check.
  --debug               Output debug logs to console
  --isoinfo ISOINFO     User specified isoinfo executable to use instead of the default version
  --image-script IMAGE_SCRIPT
                        User specified image.py script to be used for packing/unpacking instead of the version extracted from the ISO. It will not be inserted into the GISO. Intended for
                        debugging purposes only.
</code>
</pre>
</div>

The tool is common for IOS-XR 64bit (EXR) and IOS-XR7 (LNT) architectures. Remember Cisco 8000 runs IOS-XR7 software architecture, thus this article focuses on IOS-XR7 options and usage.

## GISO Creation

## GISO Verification

## Conclusion

## Acknowledgements
